<!DOCTYPE html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <title>Tetris</title>
   <style>
      html, body, canvas {
         margin: 0;
         padding: 0
      }
      html, body { 
         width:100%; 
         height:100%; 
         overflow:hidden;
      }
	  canvas {
		 border-style: solid;
		 border-width: 2px;
	  }
   </style>
</head>

<body>
  <center>
    <table>
      <tr>Tetris<br></tr>
      <tr valign=TOP>
        <td>
          <center><div>Next Block</div></center>
          <canvas id="next" width="75" height="100"></canvas>
        </td>
        <td>
          <canvas id="canvas" width="250" height="450"></canvas>
        </td>
        <td>
          <div>Score: </div><div id="score"> </div>
        </td>
      </tr>
    </table>
  </center>

  <script type="text/javascript" src="Block.js"></script>
  <script type="text/javascript"> 

    var CELL_SIZE = 25;
    var INTERVAL = 250; // milliseconds

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var nextCanvas = document.getElementById('next');
    var nextCtx = next.getContext('2d');

    var inactiveBlocks = [];
    var activeBlock = new Block(ctx, Math.floor(Math.random() * 7), 4, 0);
    var nextBlock = new Block(nextCtx, Math.floor(Math.random() * 7), 1, 1);
    var cellPicture = new Image();
    var completedRows = 0;
    var isRunning = true;
    cellPicture.src = 'cell.png';
      
    function clearGrid(ctx) {
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, 10 * CELL_SIZE, 18 * CELL_SIZE);
    }

    draw();

    function doKeyDown(evt) {
	   if(evt.keyCode === 37) { //Left Arrow
	      if(activeBlock.canMoveLeft()) { 
          activeBlock.moveLeft(); 
        }
		  }
  		  if(evt.keyCode === 39) { //Right Arrow
		    	 if(activeBlock.canMoveRight()) { 
           activeBlock.moveRight(); 
         }
	  	  }
	    	if(evt.keyCode === 32) { //Spacebar
        if(activeBlock.canRotate()) {
          activeBlock.rotate();
        }
	    }
	  }

    function draw() {
      clearGrid(ctx);
      clearGrid(nextCtx);
		  for (var i = 0; i < inactiveBlocks.length; ++i) {
          inactiveBlocks[i].draw(ctx);
       }
        
       activeBlock.draw(ctx);		
       nextBlock.draw(nextCtx);
    }

    function drawCell(ctx, x, y) {
	    ctx.drawImage(cellPicture, x * CELL_SIZE, y * CELL_SIZE);
    }

    function update() {
      if(activeBlock.canDrop()) {
        activeBlock.drop();
      } else {
        inactiveBlocks.push(activeBlock);
        activeBlock = new Block(ctx, nextBlock.type, 4, 0);
        nextBlock = new Block(nextCtx, Math.floor(Math.random() * 7), 1, 1);
        if(activeBlock.canDrop() === false) {
          gameRunning = false;
          clearInterval(INTERVAL);
          alert('Game Over!');
        }
      }
    };

    function completeRows() {
   
    };

    function gameLoop() {
      update();
      completeRows();
      draw();

      document.getElementById('score').innerHTML=completedRows;
      if(isRunning) setTimeout("gameLoop()", INTERVAL);
    };

    gameLoop();

    window.addEventListener('keydown', doKeyDown, true);
	 
  </script>

</body>
</html>

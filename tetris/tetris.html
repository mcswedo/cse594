<!DOCTYPE html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <title>Tetris</title>
   <style>
      html, body, canvas {
         margin: 0;
         padding: 0
      }
      html, body { 
         width:100%; 
         height:100%; 
         overflow:hidden;
      }
	  canvas {
		 border-style: solid;
		 border-width: 5px;
	  }
   </style>
</head>

<body>
   <canvas id="canvas" width="250" height="450"></canvas>
   <script type="text/javascript" src="Block.js"></script>
   <script type="text/javascript"> 

    var CELL_SIZE = 25;
    var INTERVAL = 150; // milliseconds
    var inactiveBlocks = [];
    var activeBlock = new Block(Math.floor(Math.random() * 7));
    var cellPicture = new Image();

    cellPicture.src = 'cell.png';
      
    function clearGrid(ctx) {
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(0, 0, 10 * CELL_SIZE, 18 * CELL_SIZE);
    }

   
    activeBlock.draw(canvas.getContext('2d'));

    function doKeyDown(evt) {
	   if(evt.keyCode === 37) { //Left Arrow
	      if(activeBlock.canMoveLeft()) { 
          activeBlock.moveLeft(); 
        }
		  }
  		  if(evt.keyCode === 39) { //Right Arrow
		    	 if(activeBlock.canMoveRight()) { 
           activeBlock.moveRight(); 
         }
	  	  }
	    	if(evt.keyCode === 32) { //Spacebar
        activeBlock.rotate();
	    }
	  }

    function draw() {
      	var canvas = document.getElementById('canvas');
      var ctx = canvas.getContext('2d');

      clearGrid(ctx);
		  for (var i = 0; i < inactiveBlocks.length; ++i) {
          inactiveBlocks[i].draw(ctx);
       }
        
       activeBlock.draw(ctx);		
    }

    function drawCell(ctx, x, y) {
	    ctx.drawImage(cellPicture, x * CELL_SIZE, y * CELL_SIZE);
    }

    var interval = setInterval(function() {
      if (activeBlock.canDrop()) {
        activeBlock.drop();
      } else {
        inactiveBlocks.push(activeBlock);
        activeBlock = new Block(Math.floor(Math.random() * 7));
        //if (activeBlock.canDrop() === false) {
          //clearInterval(interval);
		     //alert('Game Over!');
        //}
      }
      draw();
    }, INTERVAL);

    window.addEventListener('keydown', doKeyDown, true);
	 
  </script>

</body>
</html>
